# Common properties
spring.application.name=application-portal-backend

# Default profile
spring.profiles.active=${SPRING_PROFILES_ACTIVE:prod}

# CORS
cors.allowed-origins=${CORS_ALLOWED_ORIGINS}

# ===============================
# Primary Database Configuration
# ===============================
spring.datasource.jdbc-url=${SPRING_DATASOURCE_JDBC_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# HIKARI POOL SETTINGS - Primary Database
# CRITICAL: These must be extremely low for free-tier PostgreSQL (3-5 connection limit)
spring.datasource.hikari.maximum-pool-size=${SPRING_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE:1}
spring.datasource.hikari.minimum-idle=${SPRING_DATASOURCE_HIKARI_MINIMUM_IDLE:0}
spring.datasource.hikari.connection-timeout=${SPRING_DATASOURCE_HIKARI_CONNECTION_TIMEOUT:60000}
spring.datasource.hikari.idle-timeout=${SPRING_DATASOURCE_HIKARI_IDLE_TIMEOUT:30000}
spring.datasource.hikari.max-lifetime=${SPRING_DATASOURCE_HIKARI_MAX_LIFETIME:600000}
spring.datasource.hikari.pool-name=PrimaryHikariPool

# ===============================
# Master Database Configuration
# ===============================
spring.datasource.master.jdbc-url=${MASTER_DATASOURCE_URL}
spring.datasource.master.username=${MASTER_DATASOURCE_USERNAME}
spring.datasource.master.password=${MASTER_DATASOURCE_PASSWORD}
spring.datasource.master.driver-class-name=org.postgresql.Driver

# HIKARI POOL SETTINGS - Master Database
# CRITICAL: These must match the primary database settings
spring.datasource.master.hikari.maximum-pool-size=${MASTER_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE:1}
spring.datasource.master.hikari.minimum-idle=${MASTER_DATASOURCE_HIKARI_MINIMUM_IDLE:0}
spring.datasource.master.hikari.connection-timeout=${MASTER_DATASOURCE_HIKARI_CONNECTION_TIMEOUT:60000}
spring.datasource.master.hikari.idle-timeout=${MASTER_DATASOURCE_HIKARI_IDLE_TIMEOUT:30000}
spring.datasource.master.hikari.max-lifetime=${MASTER_DATASOURCE_HIKARI_MAX_LIFETIME:600000}
spring.datasource.master.hikari.pool-name=MasterHikariPool

# JPA Configuration
# DOES NOT explicitly set hibernate.dialect - let Hibernate auto-detect it
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
spring.jpa.show-sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.format_sql=true

# Logging
logging.level.root=INFO
logging.level.org.springframework.security=WARN
logging.level.com.igirerwanda.application_portal_backend=${LOGGING_LEVEL_COM_IGIRERWANDA:INFO}
logging.level.org.hibernate.orm.deprecation=${LOGGING_LEVEL_ORG_HIBERNATE_ORM_DEPRECATION:ERROR}
logging.level.com.zaxxer.hikari=DEBUG

# Swagger
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html

# Admin Bootstrap
app.admin.bootstrap.enabled=true
app.admin.bootstrap.email=admin@igirerwanda.com
app.admin.bootstrap.password=${APP_ADMIN_BOOTSTRAP_PASSWORD}

# EMAIL CONFIGURATION (BREVO API)
brevo.api.key=${BREVO_API_KEY}
app.mail.from=${MAIL_FROM_ADDRESS}
app.mail.from.name=${MAIL_USERNAME}

# JWT Configuration
jwt.secret=${JWT_SECRET}
jwt.access.token.expiration=${JWT_ACCESS_TOKEN_EXPIRATION:900000}
jwt.refresh.token.expiration=${JWT_REFRESH_TOKEN_EXPIRATION:604800000}

# OAuth2 Google
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET}
spring.security.oauth2.client.registration.google.scope=openid,profile,email
spring.security.oauth2.client.registration.google.redirect-uri=${baseUrl}/login/oauth2/code/google

# Actuator
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always
server.port=${SERVER_PORT:8080}

# WebSocket
spring.websocket.allowed-origins=*
spring.messaging.stomp.websocket.allowed-origins=*

# Frontend URL
app.frontend.base-url=${FRONTEND_BASE_URL}

# CRITICAL for Railway (behind reverse proxy)
server.forward-headers-strategy=NATIVE